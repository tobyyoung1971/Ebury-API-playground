<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Subscriptions</title>
    <script>
        function deleteSubscription(subscriptionId) {
            fetch(`/webhooks/delete/${subscriptionId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                //this if statement needs to be updated once delete function is fixed in back end
                if (data.status === 'success') {
                    document.getElementById(`subscription-${subscriptionId}`).remove();
                } else {
                    alert('Failed to delete subscription');
                }
            });
        }

        function disableSubscription(subscriptionId) {
            fetch(`/webhooks/disable/${subscriptionId}`, {
                method: 'PATCH'
            })
            .then(response => response.json())
            .then(data => {
                console.log("Disable response:", data);
                if (data.data && data.data.updateSubscription && data.data.updateSubscription.subscription.active === false) {
                    document.getElementById(`subscription-${subscriptionId}`).querySelector('.status').textContent = 'Inactive';
                } else {
                    alert('Failed to disable subscription');
                }
            });
        }
    </script>
</head>
<body>
    <h1>Webhook Subscriptions</h1>
    <ul>
        {% for subscription in subscriptions.data.subscriptions.nodes %}
            <li id="subscription-{{ subscription.id }}">
                <strong>ID:</strong> {{ subscription.id }}<br>
                <strong>Created At:</strong> {{ subscription.createdAt }}<br>
                <strong>URL:</strong> {{ subscription.url }}<br>
                <strong>Status:</strong> <span class="status">{{ 'Active' if subscription.active else 'Inactive' }}</span><br>
                <strong>Types:</strong> {{ subscription.types | join(', ') }}<br>
                <button onclick="deleteSubscription('{{ subscription.id }}')">Delete</button>
                <button onclick="disableSubscription('{{ subscription.id }}')">Disable</button>
            </li>
        {% endfor %}
    </ul>
</body>
</html>